<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>C++11 Thread Parallelization</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../Blaze.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blaze.jpg"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">C++11 Thread Parallelization </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#cpp_threads_setup">C++11 Thread Setup</a></li>
<li class="level1"><a href="#cpp_threads_configuration">C++11 Thread Configuration</a></li>
<li class="level1"><a href="#cpp_threads_known_issues">Known Issues</a></li>
</ul>
</div>
<div class="textblock"><p>In addition to the OpenMP-based shared memory parallelization, starting with <b>Blaze</b> 2.1, <b>Blaze</b> also provides a shared memory parallelization based on C++11 threads.</p>
<p><br />
 </p>
<h1><a class="anchor" id="cpp_threads_setup"></a>
C++11 Thread Setup</h1>
<hr/>
<p>In order to enable the C++11 thread-based parallelization, first the according C++11-specific compiler flags have to be used and second the <code>BLAZE_USE_CPP_THREADS</code> command line argument has to be explicitly specified. For instance, in case of the GNU C++ and Clang compilers the compiler flags have to be extended by</p>
<div class="fragment"><div class="line">... -<a class="code" href="../../d8/dcc/namespacestd.html">std</a>=c++11 -DBLAZE_USE_CPP_THREADS ...</div></div><!-- fragment --><p>This simple action will cause the <b>Blaze</b> library to automatically try to run all operations in parallel with the specified number of C++11 threads. Note that in case both OpenMP and C++11 threads are enabled on the command line, the OpenMP-based parallelization has priority and is preferred.</p>
<p>The number of threads can be either specified via the environment variable <code>BLAZE_NUM_THREADS</code> </p>
<div class="fragment"><div class="line">export BLAZE_NUM_THREADS=4  <span class="comment">// Unix systems</span></div><div class="line"><span class="keyword">set</span> BLAZE_NUM_THREADS=4     <span class="comment">// Windows systems</span></div></div><!-- fragment --><p>or alternatively via the <code><a class="el" href="../../dc/d00/group__smp.html#ga5434a72b76ef2fcf1ecb9901689f8159" title="Sets the number of threads to be used for thread parallel operations. ">setNumThreads()</a></code> function provided by the <b>Blaze</b> library:</p>
<div class="fragment"><div class="line"><a class="code" href="../../dc/d00/group__smp.html#ga5434a72b76ef2fcf1ecb9901689f8159">blaze::setNumThreads</a>( 4 );</div></div><!-- fragment --><p>Please note that the <b>Blaze</b> library does not limit the available number of threads. Therefore it is in YOUR responsibility to choose an appropriate number of threads. The best performance, though, can be expected if the specified number of threads matches the available number of cores.</p>
<p>In order to query the number of threads used for the parallelization of operations, the <code><a class="el" href="../../dc/d00/group__smp.html#ga3d5444159a291c35ca703ae5d58366ad" title="Returns the number of threads used for thread parallel operations. ">getNumThreads()</a></code> function can be used:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> threads = <a class="code" href="../../dc/d00/group__smp.html#ga3d5444159a291c35ca703ae5d58366ad">blaze::getNumThreads</a>();</div></div><!-- fragment --><p>In the context of C++11 threads, the function will return the previously specified number of threads.</p>
<p><br />
 </p>
<h1><a class="anchor" id="cpp_threads_configuration"></a>
C++11 Thread Configuration</h1>
<hr/>
<p>As in case of the OpenMP-based parallelization <b>Blaze</b> is not unconditionally running an operation in parallel. In case <b>Blaze</b> deems the parallel execution as counterproductive for the overall performance, the operation is executed serially. One of the main reasons for not executing an operation in parallel is the size of the operands. For instance, a vector addition is only executed in parallel if the size of both vector operands exceeds a certain threshold. Otherwise, the performance could seriously decrease due to the overhead caused by the thread setup. However, in order to be able to adjust the <b>Blaze</b> library to a specific system, it is possible to configure these thresholds manually. All thresholds are contained within the configuration file <code>./blaze/config/Thresholds.h</code>.</p>
<p>Please note that these thresholds are highly sensitiv to the used system architecture and the shared memory parallelization technique. Therefore the default values cannot guarantee maximum performance for all possible situations and configurations. They merely provide a reasonable standard for the current CPU generation. Also note that the provided defaults have been determined using the OpenMP parallelization and require individual adaption for the C++11 thread parallelization.</p>
<p><br />
 </p>
<h1><a class="anchor" id="cpp_threads_known_issues"></a>
Known Issues</h1>
<hr/>
<p>There is a known issue in Visual Studio 2012 and 2013 that may cause C++11 threads to hang if their destructor is executed after the <code>main()</code> function:</p>
<p><a href="http://connect.microsoft.com/VisualStudio/feedback/details/747145">http://connect.microsoft.com/VisualStudio/feedback/details/747145</a></p>
<p>Unfortunately, the C++11 parallelization of the <b>Blaze</b> library is affected from this bug. In order to circumvent this problem, <b>Blaze</b> provides the <code><a class="el" href="../../dc/d00/group__smp.html#ga5cd94547d34f86f8b15161c968a941fe" title="Provides a reliable shutdown of C++11 threads for Visual Studio compilers. ">shutDownThreads()</a></code> function, which can be used to manually destroy all threads at the end of the <code>main()</code> function:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">   <span class="comment">// ... Using the C++11 thread parallelization of Blaze</span></div><div class="line"></div><div class="line">   <a class="code" href="../../dc/d00/group__smp.html#ga5cd94547d34f86f8b15161c968a941fe">shutDownThreads</a>();</div><div class="line">}</div></div><!-- fragment --><p>Please note that this function may only be used at the end of the <code>main()</code> function. After this function no further computation may be executed! Also note that this function has an effect for Visual Studio compilers only and doesn't need to be used with any other compiler.</p>
<p><br />
 Previous: <a class="el" href="../../d4/d55/openmp_parallelization.html">OpenMP Parallelization</a> &#160; &#160; Next: <a class="el" href="../../d9/d05/boost_threads_parallelization.html">Boost Thread Parallelization</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Aug 18 2017 05:50:23 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
