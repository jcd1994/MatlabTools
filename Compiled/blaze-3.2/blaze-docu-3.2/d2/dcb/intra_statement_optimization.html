<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Intra-Statement Optimization</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../Blaze.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../blaze.jpg"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Intra-Statement Optimization </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>One of the prime features of the <b>Blaze</b> library is the automatic intra-statement optimization. In order to optimize the overall performance of every single statement <b>Blaze</b> attempts to rearrange the operands based on their types. For instance, the following addition of dense and sparse vectors</p>
<div class="fragment"><div class="line"><a class="code" href="../../da/d9e/classblaze_1_1DynamicVector.html">blaze::DynamicVector&lt;double&gt;</a> d1, d2, d3;</div><div class="line"><a class="code" href="../../d5/d35/classblaze_1_1CompressedVector.html">blaze::CompressedVector&lt;double&gt;</a> s1;</div><div class="line"></div><div class="line"><span class="comment">// ... Resizing and initialization</span></div><div class="line"></div><div class="line">d3 = d1 + s1 + d2;</div></div><!-- fragment --><p>is automatically rearranged and evaluated as</p>
<div class="fragment"><div class="line"><span class="comment">// ...</span></div><div class="line">d3 = d1 + d2 + s1;  <span class="comment">// &lt;- Note that s1 and d2 have been rearranged</span></div></div><!-- fragment --><p>This order of operands is highly favorable for the overall performance since the addition of the two dense vectors <code>d1</code> and <code>d2</code> can be handled much more efficiently in a vectorized fashion.</p>
<p>This intra-statement optimization can have a tremendous effect on the performance of a statement. Consider for instance the following computation:</p>
<div class="fragment"><div class="line"><a class="code" href="../../de/d1e/classblaze_1_1DynamicMatrix.html">blaze::DynamicMatrix&lt;double&gt;</a> A, B;</div><div class="line"><a class="code" href="../../da/d9e/classblaze_1_1DynamicVector.html">blaze::DynamicVector&lt;double&gt;</a> x, y;</div><div class="line"></div><div class="line"><span class="comment">// ... Resizing and initialization</span></div><div class="line"></div><div class="line">y = A * B * x;</div></div><!-- fragment --><p>Since multiplications are evaluated from left to right, this statement would result in a matrix/matrix multiplication, followed by a matrix/vector multiplication. However, if the right subexpression is evaluated first, the performance can be dramatically improved since the matrix/matrix multiplication can be avoided in favor of a second matrix/vector multiplication. The <b>Blaze</b> library exploits this by automatically restructuring the expression such that the right multiplication is evaluated first:</p>
<div class="fragment"><div class="line"><span class="comment">// ...</span></div><div class="line">y = A * ( B * x );</div></div><!-- fragment --><p>Note however that although this intra-statement optimization may result in a measurable or even significant performance improvement, this behavior may be undesirable for several reasons, for instance because of numerical stability. Therefore, in case the order of evaluation matters, the best solution is to be explicit and to separate a statement into several statements:</p>
<div class="fragment"><div class="line"><a class="code" href="../../da/d9e/classblaze_1_1DynamicVector.html">blaze::DynamicVector&lt;double&gt;</a> d1, d2, d3;</div><div class="line"><a class="code" href="../../d5/d35/classblaze_1_1CompressedVector.html">blaze::CompressedVector&lt;double&gt;</a> s1;</div><div class="line"></div><div class="line"><span class="comment">// ... Resizing and initialization</span></div><div class="line"></div><div class="line">d3  = d1 + s1;  <span class="comment">// Compute the dense vector/sparse vector addition first ...</span></div><div class="line">d3 += d2;       <span class="comment">// ... and afterwards add the second dense vector</span></div></div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">// ...</span></div><div class="line"><a class="code" href="../../de/d1e/classblaze_1_1DynamicMatrix.html">blaze::DynamicMatrix&lt;double&gt;</a> A, B, C;</div><div class="line"><a class="code" href="../../da/d9e/classblaze_1_1DynamicVector.html">blaze::DynamicVector&lt;double&gt;</a> x, y;</div><div class="line"></div><div class="line"><span class="comment">// ... Resizing and initialization</span></div><div class="line"></div><div class="line">C = A * B;  <span class="comment">// Compute the left-hand side matrix-matrix multiplication first ...</span></div><div class="line">y = C * x;  <span class="comment">// ... before the right-hand side matrix-vector multiplication</span></div></div><!-- fragment --><p>Alternatively, it is also possible to use the <code><a class="el" href="../../db/df0/group__dense__matrix.html#ga19b5ef8a28958146c85a18ef72886b82" title="Forces the evaluation of the given dense matrix expression dm. ">eval()</a></code> function to fix the order of evaluation:</p>
<div class="fragment"><div class="line"><a class="code" href="../../da/d9e/classblaze_1_1DynamicVector.html">blaze::DynamicVector&lt;double&gt;</a> d1, d2, d3;</div><div class="line"><a class="code" href="../../d5/d35/classblaze_1_1CompressedVector.html">blaze::CompressedVector&lt;double&gt;</a> s1;</div><div class="line"></div><div class="line"><span class="comment">// ... Resizing and initialization</span></div><div class="line"></div><div class="line">d3 = d1 + <a class="code" href="../../db/df0/group__dense__matrix.html#ga19b5ef8a28958146c85a18ef72886b82">eval</a>( s1 + d2 );</div></div><!-- fragment --><div class="fragment"><div class="line"><a class="code" href="../../de/d1e/classblaze_1_1DynamicMatrix.html">blaze::DynamicMatrix&lt;double&gt;</a> A, B;</div><div class="line"><a class="code" href="../../da/d9e/classblaze_1_1DynamicVector.html">blaze::DynamicVector&lt;double&gt;</a> x, y;</div><div class="line"></div><div class="line"><span class="comment">// ... Resizing and initialization</span></div><div class="line"></div><div class="line">y = <a class="code" href="../../db/df0/group__dense__matrix.html#ga19b5ef8a28958146c85a18ef72886b82">eval</a>( A * B ) * x;</div></div><!-- fragment --><p><br />
 Previous: <a class="el" href="../../de/d51/block_vectors_and_matrices.html">Block Vectors and Matrices</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Aug 18 2017 05:50:23 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
